import{p as s}from"./pocketbase.a05c9fd4.js";import{_ as m}from"./_plugin-vue_export-helper.a1a6add7.js";import{o as a,a as c,b as n,t as d,F as k,r as x,e as p,f as u,u as f,h as C,i as S,w as b,j as w,p as O,k as A}from"./entry.70609e10.js";import{O as $}from"./Options.ed4d10f8.js";const D={name:"DataDisplay",data(){return{formatted:[]}},props:{day_data:{type:Object,default:"Null"},heading:{type:String,default:"err"},day:{type:String,default:"h"}},methods:{fmt_data(){let e=[];this.day=="h"?e=atob(s.currentUser.h_hash).split("!!!"):e=atob(s.currentUser.m_hash).split("!!!");for(let t=0;t<e.length;t++)e[t]=e[t].split("|");this.formatted=e}},beforeMount(){s.instance.collection("users").subscribe(s.currentUser.id,async e=>{setTimeout(()=>{this.fmt_data()},400)})},mounted(){this.fmt_data()}},L={class:"data-display"},T={key:1};function B(e,t,o,h,i,l){return a(),c("div",L,[n("h2",null,d(o.heading),1),i.formatted[0]!=""?(a(!0),c(k,{key:0},x(i.formatted,(r,y)=>(a(),c("div",null,[n("p",null,[p(d(r[1])+" "+d(r[2])+" ",1),n("i",null,d(r[5]),1)])]))),256)):(a(),c("div",T," Keine Ereignisse "))])}const M=m(D,[["render",B]]),V={name:"Display",props:{currentUser:s.currentUser},data(){return{h_data:{hash:atob(this.currentUser.h_hash)},m_data:{hash:atob(this.currentUser.m_hash)},days:{day_1:"",day_2:""}}},async mounted(){const e=await s.instance.collection("times").getOne("ux8ausqmf2h57dd");this.days.day_1=e.day_1,this.days.day_2=e.day_2}},H={id:"display"},I={id:"display-container",class:"area",pos:"top"},R=n("div",{id:"seperator"},null,-1);function j(e,t,o,h,i,l){const r=M;return a(),c("div",H,[n("div",I,[u(r,{day_data:i.h_data,heading:i.days.day_1},null,8,["day_data","heading"]),R,u(r,{day_data:i.m_data,heading:i.days.day_2,day:"m"},null,8,["day_data","heading"])])])}const F=m(V,[["render",j]]),W={name:"ScoreDisplay",data(){return{list:[],ranking:0}},async mounted(){const e=await s.instance.collection("users").getFullList(200,{});this.list=e,this.list.sort((t,o)=>o.score+o.h_score-(t.score+t.h_score));for(let t=0;t<this.list.length;t++)if(this.list[t].id==s.currentUser.id){this.ranking=t;break}this.list.splice(5,this.list.length-5)}},z={class:"area",id:"score-display"},K={id:"score-content"},G=n("h2",null,"EVA SCORE",-1),P=n("h3",null,"DEIN SCORE",-1),J=n("h3",null,"TOP 5 SCORE",-1),q={id:"your-score",class:"score"},Q={style:{margin:"0"}},Y=n("div",{id:"score-seperator"},null,-1),X={id:"top-score",class:"score"},Z={key:0},tt={key:0,style:{color:"rgb(157, 241, 154)"}},et={key:1};function nt(e,t,o,h,i,l){return a(),c("div",z,[n("div",K,[G,P,J,n("div",q,[n("div",null,[n("h2",null,d(f(s).currentUser.score+f(s).currentUser.h_score),1),n("h6",Q,"(Platz "+d(i.ranking)+")",1)])]),Y,n("div",X,[n("div",null,[(a(!0),c(k,null,x(i.list,(r,y)=>(a(),c("div",null,[r.score+r.h_score!=0?(a(),c("div",Z,[r.id==f(s).currentUser.id?(a(),c("div",tt,d(r.score+r.h_score),1)):(a(),c("div",et,d(r.score+r.h_score),1))])):C("",!0)]))),256))])])])])}const st=m(W,[["render",nt]]);function it(e){const t="=".repeat((4-e.length%4)%4),o=(e+t).replace(/\-/g,"+").replace(/_/g,"/"),h=window.atob(o);return Uint8Array.from([...h].map(i=>i.charCodeAt(0)))}async function ot(){try{const e=await navigator.serviceWorker.ready,t="BOYI_ijgk8RgymTmVmEu9_Kmtpun5-R790EByhTQ26Ba33WRo3LOg93BhUAFD3cvnVaCCR9tyH1lMiN8xuDlDbA",o=await e.pushManager.subscribe({userVisibleOnly:!0,applicationServerKey:it(t)});return await s.instance.collection("users").update(s.currentUser.id,{notifications:JSON.stringify(o)}),!0}catch(e){return console.log(e),alert(`Error: Version nicht unterstuetzt /
Benachrichtigungen abgelehnt`),!1}}var rt;const at={subscribe:ot,registration:rt},ct={name:"EnableNotification",data(){return{notifications:!1}},mounted(){this.notifications=s.currentUser.notifications!=""},methods:{async clicked(){if(this.has_notifications()){await s.instance.collection("users").update(s.currentUser.id,{notifications:""}),this.notifications=!1;return}navigator.serviceWorker.register("service-worker.js");const t=await(await navigator.serviceWorker.ready).pushManager.getSubscription();if(t)await s.instance.collection("users").update(s.currentUser.id,{notifications:JSON.stringify(t)}),this.notifications=!0;else{const o=await at.subscribe();this.notifications=o}},has_notifications(){return s.currentUser.notifications!=""}}};function dt(e,t,o,h,i,l){return a(),c("button",{class:S({disablenotification:i.notifications}),id:"notify",onClick:t[0]||(t[0]=(...r)=>l.clicked&&l.clicked(...r))},"BENACHRICHTIGUNGEN",2)}const lt=m(ct,[["render",dt]]),ut={components:{Options:$},data(){return{currentUser:s.instance.authStore.model}},methods:{loading(e){const t=e;var o="L\xE4dt";t.innerHTML=o+".",setInterval(function(){t.innerHTML.length>o.length+3?t.innerHTML=o+".":t.innerHTML+="."},400)},async signOut(e){this.loading(e.srcElement),s.instance.authStore.clear()},async deleteAccount(e){const t=prompt("Willst du den Account wirklich l\xF6schen? (ja/nein)");this.currentUser&&t=="ja"&&s.instance.collection("users").delete(this.currentUser.id)}},mounted(){s.instance.authStore.onChange(e=>{this.currentUser=s.instance.authStore.model})}};const _=e=>(O("data-v-95e5d101"),e=e(),A(),e),_t={id:"main-content"},ht={key:0,id:"main-settings"},pt={key:0},ft={id:"main-heading"},mt=_(()=>n("br",null,null,-1)),yt=_(()=>n("br",null,null,-1)),gt={id:"mail-notify"},vt={key:1},Ut=_(()=>n("p",{id:"confirm"},"Bitte email best\xE4tigen und danach neu laden",-1)),bt=[Ut],kt={key:1},xt=_(()=>n("h1",null,"LMG Vertretungsplan Bot \u{1F916}",-1)),$t=_(()=>n("p",null,"Automatische Nachrichten zu deinen aktuellen Vertetungen/Entf\xE4llen (beta)",-1)),Et=_(()=>n("button",{id:"signin"},"ANMELDEN",-1)),Nt=_(()=>n("button",{id:"signin"},"ACCOUNT ERSTELLEN",-1));function Ct(e,t,o,h,i,l){var U;const r=F,y=st,E=$,N=lt,v=w;return a(),c("div",_t,[i.currentUser?(a(),c("div",ht,[i.currentUser.verified?(a(),c("div",pt,[n("h1",ft,"HALLO, "+d((U=i.currentUser)==null?void 0:U.email.split("@")[0].toUpperCase()),1),u(r,{currentUser:i.currentUser},null,8,["currentUser"]),u(y),u(E,{currentUser:i.currentUser},null,8,["currentUser"]),u(N),n("p",null,[p("Angemeldet!"),mt,p("(user-id: "+d(f(s).currentUser.id)+")",1),yt,p("( "),n("i",gt,d(f(s).currentUser.email),1),p(")")])])):(a(),c("div",vt,bt)),n("button",{id:"signout",onClick:t[0]||(t[0]=g=>l.signOut(g))},"ABMELDEN"),n("button",{id:"delete",onClick:t[1]||(t[1]=g=>l.deleteAccount(g))},"ACCOUNT L\xD6SCHEN")])):(a(),c("div",kt,[xt,$t,u(v,{to:"/login"},{default:b(()=>[Et]),_:1}),u(v,{to:"/signup"},{default:b(()=>[Nt]),_:1})]))])}const Dt=m(ut,[["render",Ct],["__scopeId","data-v-95e5d101"]]);export{Dt as default};
