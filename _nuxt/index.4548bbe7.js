import{u as D}from"./pocketbase.452a775a.js";import{a as z,r as L,b as B,e as $,f as H,w as F,u as v,h as K,i as w,o as f,j as p,k as c,t as k,F as I,l as R,m as G,p as U,q as V,s as x,v as W,x as Z,y as q,z as Q,A as P,B as J,C as Y,D as X}from"./entry.6090f691.js";import{_ as ee}from"./_plugin-vue_export-helper.a1a6add7.js";const te=()=>null;function j(...u){var r,m,g,A,T,M,O;const a=typeof u[u.length-1]=="string"?u.pop():void 0;typeof u[0]!="string"&&u.unshift(a);let[e,o,t={}]=u;if(typeof e!="string")throw new TypeError("[nuxt] [asyncData] key must be a string.");if(typeof o!="function")throw new TypeError("[nuxt] [asyncData] handler must be a function.");t.server=(r=t.server)!=null?r:!0,t.default=(m=t.default)!=null?m:te,t.lazy=(g=t.lazy)!=null?g:!1,t.immediate=(A=t.immediate)!=null?A:!0;const n=z(),d=()=>n.isHydrating?n.payload.data[e]:n.static.data[e],i=()=>d()!==void 0;n._asyncData[e]||(n._asyncData[e]={data:L((O=(M=d())!=null?M:(T=t.default)==null?void 0:T.call(t))!=null?O:null),pending:L(!i()),error:L(n.payload._errors[e]?B(n.payload._errors[e]):null)});const s={...n._asyncData[e]};s.refresh=s.execute=(b={})=>{if(n._asyncDataPromises[e]){if(b.dedupe===!1)return n._asyncDataPromises[e];n._asyncDataPromises[e].cancelled=!0}if(b._initial&&i())return d();s.pending.value=!0;const C=new Promise((y,E)=>{try{y(o(n))}catch(N){E(N)}}).then(y=>{if(C.cancelled)return n._asyncDataPromises[e];t.transform&&(y=t.transform(y)),t.pick&&(y=ne(y,t.pick)),s.data.value=y,s.error.value=null}).catch(y=>{var E,N;if(C.cancelled)return n._asyncDataPromises[e];s.error.value=y,s.data.value=v((N=(E=t.default)==null?void 0:E.call(t))!=null?N:null)}).finally(()=>{C.cancelled||(s.pending.value=!1,n.payload.data[e]=s.data.value,s.error.value&&(n.payload._errors[e]=B(s.error.value)),delete n._asyncDataPromises[e])});return n._asyncDataPromises[e]=C,n._asyncDataPromises[e]};const h=()=>s.refresh({_initial:!0}),_=t.server!==!1&&n.payload.serverRendered;{const b=K();if(b&&!b._nuxtOnBeforeMountCbs){b._nuxtOnBeforeMountCbs=[];const y=b._nuxtOnBeforeMountCbs;b&&($(()=>{y.forEach(E=>{E()}),y.splice(0,y.length)}),H(()=>y.splice(0,y.length)))}_&&n.isHydrating&&i()?s.pending.value=!1:b&&(n.payload.serverRendered&&n.isHydrating||t.lazy)&&t.immediate?b._nuxtOnBeforeMountCbs.push(h):t.immediate&&h(),t.watch&&F(t.watch,()=>s.refresh());const C=n.hook("app:data:refresh",y=>{if(!y||y.includes(e))return s.refresh()});b&&H(C)}const l=Promise.resolve(n._asyncDataPromises[e]).then(()=>s);return Object.assign(l,s),l}function ne(u,a){const e={};for(const o of a)e[o]=u[o];return e}const se={key:0,class:"data-display"},ae={key:0},oe={key:1},ie=w({__name:"DataDisplay",props:{heading:null,day:null},setup(u){const a=u,e=D();var o=e.authStore.model;e.authStore.onChange(d=>{o=e.authStore.model,window.location.reload()});var t=[];function n(d){let i=[];a.day=="h"?i=atob(d.h_hash).split("!!!"):i=atob(d.m_hash).split("!!!");for(let s=0;s<i.length;s++)i[s]=i[s].split("|");t=i}return $(()=>{!o||e.collection("users").subscribe(o.id,async d=>{n(d.record)})}),n(o),(d,i)=>v(t)?(f(),p("div",se,[c("h2",null,k(u.heading),1),v(t)[0]!=""?(f(),p("div",ae,[(f(!0),p(I,null,R(v(t),(s,h)=>(f(),p("div",{key:h},[c("p",null,[G(k(s[1])+" "+k(s[2])+" ",1),c("i",null,k(s[5]),1)])]))),128))])):(f(),p("div",oe," Keine Ereignisse "))])):U("",!0)}}),re={id:"display"},ce={id:"display-container",class:"area",pos:"top"},le=c("div",{id:"seperator"},null,-1),ue=w({__name:"Display",async setup(u){let a,e;const o=D();o.authStore.model,o.authStore.onChange(n=>{o.authStore.model});const{data:t}=([a,e]=V(async()=>j("dates",async()=>{const n=await o.collection("times").getOne("ux8ausqmf2h57dd");return{day_1:n.day_1,day_2:n.day_2}})),a=await a,e(),a);return(n,d)=>{var s,h;const i=ie;return f(),p("div",re,[c("div",ce,[x(i,{heading:(s=v(t))==null?void 0:s.day_1,day:"h"},null,8,["heading"]),le,x(i,{heading:(h=v(t))==null?void 0:h.day_2,day:"m"},null,8,["heading"])])])}}}),de={class:"area",id:"score-display"},_e={id:"score-content"},he=c("h2",null,"EVA SCORE",-1),fe=c("h3",null,"DEIN SCORE",-1),pe=c("h3",null,"TOP 5 SCORE",-1),ye={id:"your-score",class:"score"},me={style:{margin:"0"}},ve=c("div",{id:"score-seperator"},null,-1),ge={id:"top-score",class:"score"},be={key:0},ke={key:0,style:{color:"rgb(157, 241, 154)"}},xe={key:1},Ce=w({__name:"ScoreDisplay",async setup(u){let a,e;const o=D();var t=o.authStore.model;o.authStore.onChange(s=>{t=o.authStore.model});var n=[],d=0;const{data:i}=([a,e]=V(async()=>j("users",async()=>{n=await o.collection("users").getFullList(200,{}),n.sort((h,_)=>_.score+_.h_score-(h.score+h.h_score));for(let h=0;h<n.length;h++)if(n[h].id==(t==null?void 0:t.id)){d=h+1;break}return n.splice(5,n.length-5),n})),a=await a,e(),a);return(s,h)=>{var _,l;return f(),p("div",de,[c("div",_e,[he,fe,pe,c("div",ye,[c("div",null,[c("h2",null,k(((_=v(t))==null?void 0:_.score)+((l=v(t))==null?void 0:l.h_score)),1),c("h6",me,"(Platz "+k(v(d))+")",1)])]),ve,c("div",ge,[c("div",null,[(f(!0),p(I,null,R(v(i),(r,m)=>{var g;return f(),p("div",{key:m},[r.score+r.h_score!=0?(f(),p("div",be,[r.id==((g=v(t))==null?void 0:g.id)?(f(),p("div",ke,k(r.score+r.h_score),1)):(f(),p("div",xe,k(r.score+r.h_score),1))])):U("",!0)])}),128))])])])])}}}),Ee={id:"login",style:{"text-align":"center"}},De={id:"login-style",class:"area",pos:"bottom"},we=c("h2",{style:{"font-weight":"900","margin-top":"0"}},"DATEN \xC4NDERN",-1),Se=c("label",null,"Kurse",-1),Ae=c("br",null,null,-1),Ne=w({__name:"Options",setup(u){const a=D();var e=a.authStore.model;a.authStore.onChange(_=>{e=a.authStore.model});var o=L(""),t="",n=!1;function d(){const _=document.getElementsByClassName("valid-check");let l=!0;for(let r=0;r<_.length;r++){const m=_[r];m.checkValidity()||(m.style.outline="3px dashed #942525",setTimeout(()=>{m.style.outline=""},4e3),l=!1)}return l}function i(_){_.preventDefault();const l=_.srcElement;o.value=l.innerHTML;const r=document.getElementsByClassName("select");for(let m=0;m<r.length;m++){const g=r[m];if(l==g){l.classList.add("selected");continue}g.classList.remove("selected")}}function s(_){const l=_,r=_;r.disabled=!0;const m=_.innerHTML;var g="L\xE4dt";l.innerHTML=g+".",n=!0;var A=setInterval(()=>{if(!n){clearInterval(A),_.innerHTML=m,r.disabled=!1;return}l.innerHTML.length>g.length+3?l.innerHTML=g+".":l.innerHTML+="."},400)}async function h(_){if(!d()){setTimeout(()=>{alert("Bitte richtige Werte in markierte felder eingeben...")},100);return}if(o.value==""){alert("Bitte eine Stufe angeben...");return}if(o.value==e.class&&t.replaceAll(",",":")==e.subjects)return;s(_.srcElement);const l={class:o.value,subjects:t.replaceAll(", ",",").replaceAll(",",":"),new_update:!0};try{if(!e)return;await a.collection("users").update(e.id,l)}catch{alert("Ein unerwarteter Fehler ist aufgetreten, versuche es sp\xE4ter erneut..."),n=!1}n=!1}return $(()=>{!e||(t=e.subjects.replaceAll(":",","),o.value=e.class,a.collection("users").subscribe(e.id,async _=>{t=_.record.subjects.replaceAll(":",",")}))}),(_,l)=>(f(),p("div",Ee,[c("div",De,[we,Se,W(c("input",{onkeyup:"this.value = this.value.toUpperCase();",class:"valid-check","onUpdate:modelValue":l[0]||(l[0]=r=>q(t)?t.value=r:t=r),id:"courses",type:"text",placeholder:"E G1,D G4,M L1,MU G1",pattern:"^[A-Z]{1,2}\\d?\\s[A-Z][1-9](,\\s?[A-Z]{1,2}\\d?\\s[A-Z][1-9])*$",required:""},null,512),[[Z,v(t)]]),c("label",null,"Stufe: "+k(v(o)),1),c("button",{ref:"select_button_1",class:"select",onClick:l[1]||(l[1]=r=>i(r))},"EF",512),c("button",{ref:"select_button_2",class:"select",onClick:l[2]||(l[2]=r=>i(r))},"Q1",512),c("button",{ref:"select_button_3",class:"select",onClick:l[3]||(l[3]=r=>i(r))},"Q2",512),Ae,c("button",{id:"update-button",onClick:l[4]||(l[4]=r=>h(r)),style:{"background-color":"rgba(255, 255, 255, 0.162)","margin-top":"23px",width:"50vw","font-size":"15px"}},"DATEN AKTUALISIEREN")])]))}});function Le(u){const a="=".repeat((4-u.length%4)%4),e=(u+a).replace(/\-/g,"+").replace(/_/g,"/"),o=window.atob(e);return Uint8Array.from([...o].map(t=>t.charCodeAt(0)))}async function $e(){try{const u=await navigator.serviceWorker.ready,a="BOYI_ijgk8RgymTmVmEu9_Kmtpun5-R790EByhTQ26Ba33WRo3LOg93BhUAFD3cvnVaCCR9tyH1lMiN8xuDlDbA",e=await u.pushManager.subscribe({userVisibleOnly:!0,applicationServerKey:Le(a)});return await pb.instance.collection("users").update(pb.currentUser.id,{notifications:JSON.stringify(e)}),!0}catch(u){return console.log(u),alert(`Error: Version nicht unterstuetzt /
Benachrichtigungen abgelehnt`),!1}}var Te;const Me={subscribe:$e,registration:Te},Oe=w({__name:"EnableNotification",setup(u){const a=D();var e=a.authStore.model;a.authStore.onChange(d=>{e=a.authStore.model});var o=!1;function t(){return e?e.notifications!="":!1}async function n(){if(t()&&e){await a.collection("users").update(e.id,{notifications:""}),o=!1;return}navigator.serviceWorker.register("service-worker.js");const i=await(await navigator.serviceWorker.ready).pushManager.getSubscription();if(!i)o=await Me.subscribe();else{if(!e)return;await a.collection("users").update(e.id,{notifications:JSON.stringify(i)}),o=!0}}return $(()=>{!e||(o=e.notifications!="")}),(d,i)=>(f(),p("button",{class:Q({disablenotification:v(o)}),id:"notify",onClick:n},"PUSH BENACHRICHTIGUNGEN",2))}}),S=u=>(Y("data-v-1af86e61"),u=u(),X(),u),Be={id:"main-content"},He={key:0,id:"main-settings"},Pe={key:0},Ie={id:"main-heading"},Re={key:1},Ue=S(()=>c("p",{id:"confirm"},"Bitte email best\xE4tigen und danach neu laden",-1)),Ve=[Ue],je={key:1},ze=S(()=>c("h1",null,"LMG Vertretungsplan Bot \u{1F916}",-1)),Fe=S(()=>c("p",null,"Automatische Nachrichten zu deinen aktuellen Vertetungen/Entf\xE4llen (beta)",-1)),Ke=S(()=>c("button",{id:"signin"},"ANMELDEN",-1)),Ge=S(()=>c("button",{id:"signin"},"ACCOUNT ERSTELLEN",-1)),We=w({__name:"index",setup(u){const a=D();var e=a.authStore.model;a.authStore.onChange(d=>{e=a.authStore.model,window.location.reload()});function o(d){const i=d;var s="L\xE4dt";i.innerHTML=s+".",setInterval(function(){i.innerHTML.length>s.length+3?i.innerHTML=s+".":i.innerHTML+="."},400)}async function t(d){o(d.srcElement),a.authStore.clear()}async function n(d){const i=prompt("Willst du den Account wirklich l\xF6schen? (ja/nein)");e&&i=="ja"&&a.collection("users").delete(e.id)}return(d,i)=>{var m;const s=ue,h=Ce,_=Ne,l=Oe,r=J;return f(),p("div",Be,[v(e)?(f(),p("div",He,[v(e).verified?(f(),p("div",Pe,[c("h1",Ie,"HALLO, "+k((m=v(e))==null?void 0:m.email.split("@")[0].toUpperCase()),1),x(s),x(h),x(_),x(l)])):(f(),p("div",Re,Ve)),c("button",{id:"signout",onClick:i[0]||(i[0]=g=>t(g))},"ABMELDEN"),c("button",{id:"delete",onClick:i[1]||(i[1]=g=>n())},"ACCOUNT L\xD6SCHEN")])):(f(),p("div",je,[ze,Fe,x(r,{to:"/login"},{default:P(()=>[Ke]),_:1}),x(r,{to:"/signup"},{default:P(()=>[Ge]),_:1})]))])}}});const Je=ee(We,[["__scopeId","data-v-1af86e61"]]);export{Je as default};
