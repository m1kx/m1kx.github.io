import{u as w}from"./pocketbase.452a775a.js";import{a as z,r as $,b as H,e as T,f as P,w as K,u as y,h as G,i as S,o as p,j as f,k as a,t as b,F as R,l as U,m as A,p as V,q as j,s as x,v as W,x as Z,y as q,z as Q,A as I,B as J,C as Y,D as X}from"./entry.e63fa943.js";import{_ as ee}from"./_plugin-vue_export-helper.a1a6add7.js";const te=()=>null;function F(...u){var c,v,g,L,M,O,B;const o=typeof u[u.length-1]=="string"?u.pop():void 0;typeof u[0]!="string"&&u.unshift(o);let[e,i,t={}]=u;if(typeof e!="string")throw new TypeError("[nuxt] [asyncData] key must be a string.");if(typeof i!="function")throw new TypeError("[nuxt] [asyncData] handler must be a function.");t.server=(c=t.server)!=null?c:!0,t.default=(v=t.default)!=null?v:te,t.lazy=(g=t.lazy)!=null?g:!1,t.immediate=(L=t.immediate)!=null?L:!0;const n=z(),d=()=>n.isHydrating?n.payload.data[e]:n.static.data[e],r=()=>d()!==void 0;n._asyncData[e]||(n._asyncData[e]={data:$((B=(O=d())!=null?O:(M=t.default)==null?void 0:M.call(t))!=null?B:null),pending:$(!r()),error:$(n.payload._errors[e]?H(n.payload._errors[e]):null)});const s={...n._asyncData[e]};s.refresh=s.execute=(k={})=>{if(n._asyncDataPromises[e]){if(k.dedupe===!1)return n._asyncDataPromises[e];n._asyncDataPromises[e].cancelled=!0}if(k._initial&&r())return d();s.pending.value=!0;const E=new Promise((m,D)=>{try{m(i(n))}catch(N){D(N)}}).then(m=>{if(E.cancelled)return n._asyncDataPromises[e];t.transform&&(m=t.transform(m)),t.pick&&(m=ne(m,t.pick)),s.data.value=m,s.error.value=null}).catch(m=>{var D,N;if(E.cancelled)return n._asyncDataPromises[e];s.error.value=m,s.data.value=y((N=(D=t.default)==null?void 0:D.call(t))!=null?N:null)}).finally(()=>{E.cancelled||(s.pending.value=!1,n.payload.data[e]=s.data.value,s.error.value&&(n.payload._errors[e]=H(s.error.value)),delete n._asyncDataPromises[e])});return n._asyncDataPromises[e]=E,n._asyncDataPromises[e]};const h=()=>s.refresh({_initial:!0}),_=t.server!==!1&&n.payload.serverRendered;{const k=G();if(k&&!k._nuxtOnBeforeMountCbs){k._nuxtOnBeforeMountCbs=[];const m=k._nuxtOnBeforeMountCbs;k&&(T(()=>{m.forEach(D=>{D()}),m.splice(0,m.length)}),P(()=>m.splice(0,m.length)))}_&&n.isHydrating&&r()?s.pending.value=!1:k&&(n.payload.serverRendered&&n.isHydrating||t.lazy)&&t.immediate?k._nuxtOnBeforeMountCbs.push(h):t.immediate&&h(),t.watch&&K(t.watch,()=>s.refresh());const E=n.hook("app:data:refresh",m=>{if(!m||m.includes(e))return s.refresh()});k&&P(E)}const l=Promise.resolve(n._asyncDataPromises[e]).then(()=>s);return Object.assign(l,s),l}function ne(u,o){const e={};for(const i of o)e[i]=u[i];return e}const se={key:0,class:"data-display"},ae={key:0},oe={key:1},ie=S({__name:"DataDisplay",props:{heading:null,day:null},setup(u){const o=u,e=w();var i=e.authStore.model;e.authStore.onChange(d=>{i=e.authStore.model,window.location.reload()});var t=[];function n(d){let r=[];o.day=="h"?r=atob(d.h_hash).split("!!!"):r=atob(d.m_hash).split("!!!");for(let s=0;s<r.length;s++)r[s]=r[s].split("|");t=r}return T(()=>{!i||e.collection("users").subscribe(i.id,async d=>{n(d.record)})}),n(i),(d,r)=>y(t)?(p(),f("div",se,[a("h2",null,b(u.heading),1),y(t)[0]!=""?(p(),f("div",ae,[(p(!0),f(R,null,U(y(t),(s,h)=>(p(),f("div",{key:h},[a("p",null,[A(b(s[1])+" "+b(s[2])+" ",1),a("i",null,b(s[5]),1)])]))),128))])):(p(),f("div",oe," Keine Ereignisse "))])):V("",!0)}}),re={id:"display"},ce={id:"display-container",class:"area",pos:"top"},le=a("div",{id:"seperator"},null,-1),ue=S({__name:"Display",async setup(u){let o,e;const i=w();i.authStore.model,i.authStore.onChange(n=>{i.authStore.model});const{data:t}=([o,e]=j(async()=>F("dates",async()=>{const n=await i.collection("times").getOne("ux8ausqmf2h57dd");return{day_1:n.day_1,day_2:n.day_2}})),o=await o,e(),o);return(n,d)=>{var s,h;const r=ie;return p(),f("div",re,[a("div",ce,[x(r,{heading:(s=y(t))==null?void 0:s.day_1,day:"h"},null,8,["heading"]),le,x(r,{heading:(h=y(t))==null?void 0:h.day_2,day:"m"},null,8,["heading"])])])}}}),de={class:"area",id:"score-display"},_e={id:"score-content"},he=a("h2",null,"EVA SCORE",-1),pe=a("h3",null,"DEIN SCORE",-1),fe=a("h3",null,"TOP 5 SCORE",-1),ye={id:"your-score",class:"score"},me={style:{margin:"0"}},ve=a("div",{id:"score-seperator"},null,-1),ge={id:"top-score",class:"score"},be={key:0},ke={key:0,style:{color:"rgb(157, 241, 154)"}},xe={key:1},Ce=S({__name:"ScoreDisplay",async setup(u){let o,e;const i=w();var t=i.authStore.model;i.authStore.onChange(s=>{t=i.authStore.model});var n=[],d=0;const{data:r}=([o,e]=j(async()=>F("users",async()=>{n=await i.collection("users").getFullList(200,{}),n.sort((h,_)=>_.score+_.h_score-(h.score+h.h_score));for(let h=0;h<n.length;h++)if(n[h].id==(t==null?void 0:t.id)){d=h+1;break}return n.splice(5,n.length-5),n})),o=await o,e(),o);return(s,h)=>{var _,l;return p(),f("div",de,[a("div",_e,[he,pe,fe,a("div",ye,[a("div",null,[a("h2",null,b(((_=y(t))==null?void 0:_.score)+((l=y(t))==null?void 0:l.h_score)),1),a("h6",me,"(Platz "+b(y(d))+")",1)])]),ve,a("div",ge,[a("div",null,[(p(!0),f(R,null,U(y(r),(c,v)=>{var g;return p(),f("div",{key:v},[c.score+c.h_score!=0?(p(),f("div",be,[c.id==((g=y(t))==null?void 0:g.id)?(p(),f("div",ke,b(c.score+c.h_score),1)):(p(),f("div",xe,b(c.score+c.h_score),1))])):V("",!0)])}),128))])])])])}}}),Ee={id:"login",style:{"text-align":"center"}},De={id:"login-style",class:"area",pos:"bottom"},we=a("h2",{style:{"font-weight":"900","margin-top":"0"}},"DATEN \xC4NDERN",-1),Se=a("label",null,"Kurse",-1),Ae=a("br",null,null,-1),Le=S({__name:"Options",setup(u){const o=w();var e=o.authStore.model;o.authStore.onChange(_=>{e=o.authStore.model});var i=$(""),t="",n=!1;function d(){const _=document.getElementsByClassName("valid-check");let l=!0;for(let c=0;c<_.length;c++){const v=_[c];v.checkValidity()||(v.style.outline="3px dashed #942525",setTimeout(()=>{v.style.outline=""},4e3),l=!1)}return l}function r(_){_.preventDefault();const l=_.srcElement;i.value=l.innerHTML;const c=document.getElementsByClassName("select");for(let v=0;v<c.length;v++){const g=c[v];if(l==g){l.classList.add("selected");continue}g.classList.remove("selected")}}function s(_){const l=_,c=_;c.disabled=!0;const v=_.innerHTML;var g="L\xE4dt";l.innerHTML=g+".",n=!0;var L=setInterval(()=>{if(!n){clearInterval(L),_.innerHTML=v,c.disabled=!1;return}l.innerHTML.length>g.length+3?l.innerHTML=g+".":l.innerHTML+="."},400)}async function h(_){if(!d()){setTimeout(()=>{alert("Bitte richtige Werte in markierte felder eingeben...")},100);return}if(i.value==""){alert("Bitte eine Stufe angeben...");return}if(i.value==e.class&&t.replaceAll(",",":")==e.subjects)return;s(_.srcElement);const l={class:i.value,subjects:t.replaceAll(", ",",").replaceAll(",",":"),new_update:!0};try{if(!e)return;await o.collection("users").update(e.id,l)}catch{alert("Ein unerwarteter Fehler ist aufgetreten, versuche es sp\xE4ter erneut..."),n=!1}n=!1}return T(()=>{!e||(t=e.subjects.replaceAll(":",","),i.value=e.class,o.collection("users").subscribe(e.id,async _=>{t=_.record.subjects.replaceAll(":",",")}))}),(_,l)=>(p(),f("div",Ee,[a("div",De,[we,Se,W(a("input",{onkeyup:"this.value = this.value.toUpperCase();",class:"valid-check","onUpdate:modelValue":l[0]||(l[0]=c=>q(t)?t.value=c:t=c),id:"courses",type:"text",placeholder:"E G1,D G4,M L1,MU G1",pattern:"^[A-Z]{1,2}\\d?\\s[A-Z][1-9](,\\s?[A-Z]{1,2}\\d?\\s[A-Z][1-9])*$",required:""},null,512),[[Z,y(t)]]),a("label",null,"Stufe: "+b(y(i)),1),a("button",{ref:"select_button_1",class:"select",onClick:l[1]||(l[1]=c=>r(c))},"EF",512),a("button",{ref:"select_button_2",class:"select",onClick:l[2]||(l[2]=c=>r(c))},"Q1",512),a("button",{ref:"select_button_3",class:"select",onClick:l[3]||(l[3]=c=>r(c))},"Q2",512),Ae,a("button",{id:"update-button",onClick:l[4]||(l[4]=c=>h(c)),style:{"background-color":"rgba(255, 255, 255, 0.162)","margin-top":"35px",width:"50vw"}},"AKTUALISIEREN")])]))}});function Ne(u){const o="=".repeat((4-u.length%4)%4),e=(u+o).replace(/\-/g,"+").replace(/_/g,"/"),i=window.atob(e);return Uint8Array.from([...i].map(t=>t.charCodeAt(0)))}async function $e(){try{const u=await navigator.serviceWorker.ready,o="BOYI_ijgk8RgymTmVmEu9_Kmtpun5-R790EByhTQ26Ba33WRo3LOg93BhUAFD3cvnVaCCR9tyH1lMiN8xuDlDbA",e=await u.pushManager.subscribe({userVisibleOnly:!0,applicationServerKey:Ne(o)});return await pb.instance.collection("users").update(pb.currentUser.id,{notifications:JSON.stringify(e)}),!0}catch(u){return console.log(u),alert(`Error: Version nicht unterstuetzt /
Benachrichtigungen abgelehnt`),!1}}var Te;const Me={subscribe:$e,registration:Te},Oe=S({__name:"EnableNotification",setup(u){const o=w();var e=o.authStore.model;o.authStore.onChange(d=>{e=o.authStore.model});var i=!1;function t(){return e?e.notifications!="":!1}async function n(){if(t()&&e){await o.collection("users").update(e.id,{notifications:""}),i=!1;return}navigator.serviceWorker.register("service-worker.js");const r=await(await navigator.serviceWorker.ready).pushManager.getSubscription();if(!r)i=await Me.subscribe();else{if(!e)return;await o.collection("users").update(e.id,{notifications:JSON.stringify(r)}),i=!0}}return T(()=>{!e||(i=e.notifications!="")}),(d,r)=>(p(),f("button",{class:Q({disablenotification:y(i)}),id:"notify",onClick:n},"PUSH BENACHRICHTIGUNGEN",2))}}),C=u=>(Y("data-v-a26a4491"),u=u(),X(),u),Be={id:"main-content"},He={key:0,id:"main-settings"},Pe={key:0},Ie={id:"main-heading"},Re=C(()=>a("br",null,null,-1)),Ue=C(()=>a("br",null,null,-1)),Ve={id:"mail-notify"},je={key:1},Fe=C(()=>a("p",{id:"confirm"},"Bitte email best\xE4tigen und danach neu laden",-1)),ze=[Fe],Ke={key:1},Ge=C(()=>a("h1",null,"LMG Vertretungsplan Bot \u{1F916}",-1)),We=C(()=>a("p",null,"Automatische Nachrichten zu deinen aktuellen Vertetungen/Entf\xE4llen (beta)",-1)),Ze=C(()=>a("button",{id:"signin"},"ANMELDEN",-1)),qe=C(()=>a("button",{id:"signin"},"ACCOUNT ERSTELLEN",-1)),Qe=S({__name:"index",setup(u){const o=w();var e=o.authStore.model;o.authStore.onChange(d=>{e=o.authStore.model,window.location.reload()});function i(d){const r=d;var s="L\xE4dt";r.innerHTML=s+".",setInterval(function(){r.innerHTML.length>s.length+3?r.innerHTML=s+".":r.innerHTML+="."},400)}async function t(d){i(d.srcElement),o.authStore.clear()}async function n(d){const r=prompt("Willst du den Account wirklich l\xF6schen? (ja/nein)");e&&r=="ja"&&o.collection("users").delete(e.id)}return(d,r)=>{var v;const s=ue,h=Ce,_=Le,l=Oe,c=J;return p(),f("div",Be,[y(e)?(p(),f("div",He,[y(e).verified?(p(),f("div",Pe,[a("h1",Ie,"HALLO, "+b((v=y(e))==null?void 0:v.email.split("@")[0].toUpperCase()),1),x(s),x(h),x(_),x(l),a("p",null,[A("Angemeldet!"),Re,A("(user-id: "+b(y(e).id)+")",1),Ue,A("( "),a("i",Ve,b(y(e).email),1),A(")")])])):(p(),f("div",je,ze)),a("button",{id:"signout",onClick:r[0]||(r[0]=g=>t(g))},"ABMELDEN"),a("button",{id:"delete",onClick:r[1]||(r[1]=g=>n())},"ACCOUNT L\xD6SCHEN")])):(p(),f("div",Ke,[Ge,We,x(c,{to:"/login"},{default:I(()=>[Ze]),_:1}),x(c,{to:"/signup"},{default:I(()=>[qe]),_:1})]))])}}});const et=ee(Qe,[["__scopeId","data-v-a26a4491"]]);export{et as default};
